<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>工具栈 | HaHack</title>
  <meta name="author" content="Joseph Pan">
  
  <meta name="description" content="JavaScript 拥有非常丰富的工具栈。
版本管理
nvm
nvm 是 node.js 的版本管理工具。安装 nvm 需要打开命令行窗口，运行下面的命令。
1$ curl -o- https://raw.githubusercontent.com/creationix/nvm/&amp;lt;versi">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="工具栈"/>
  <meta property="og:site_name" content="HaHack"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/images/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="HaHack" type="application/atom+xml">
  
  <link rel="stylesheet" href="/dist/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/bootstrap-responsive.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/font-awesome.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/style.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/highlight.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/sidenav.min.css" media="screen" type="text/css">  
  <link rel="stylesheet" href="/dist/responsive.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/bubble.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/google-fonts.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/nprogress.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/dist/comment.min.css" media="screen" type="text/css">
  
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <!--[if lte IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

<!--  -->
<!--     <link href='https://fonts.googleapis.com/css?family=PT+Sans+Narrow|PT+Sans:400,400italic,700,700italic|Droid+Serif:400,400italic' rel='stylesheet' type='text/css'> -->
<!--     <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'> -->
<!--  -->
  
<script src="/dist/jquery-2.0.3.min.js"></script>


    <script src="/dist/videoGFW.min.js"></script>
	
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-41569408-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;

ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';

var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

	


    <link rel="stylesheet" href="/dist/highlight-default.min.css" media="screen" type="text/css">
    
    <script src="/dist/comment.min.js"></script>
    <script src="/dist/marked.min.js"></script>
    
    <script src="/dist/highlight.min.js"></script>
    <script src="/dist/timeago.min.js"></script>
	<script src="/dist/spin.min.js"></script>


</head>


<body data-spy="scroll" data-target=".toc">  
  <header id="header" class="inner"><div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
            <a data-pjax class="brand" href="/">HaHack</a>
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <div class="nav-collapse collapse">
            <ul class="nav">				
			    
				   <li><a data-pjax href="/archive" title="所有文章归档"><i class="fa fa-archive"></i>Archive</a></li>				   			    			
				   <li><a data-pjax href="/categories" title="所有文章分类"><i class="fa fa-folder"></i>Categories</a></li>				   			    			
				   <li><a data-pjax href="/tags" title="所有文章标签"><i class="fa fa-tags"></i>Tags</a></li>				   			    			
				
				<li class="divider-vertical"></li>
			   	<li><a data-pjax href="/wiki" title="我的笔记库"><i class="fa fa-tasks"></i>wiki</a></li>				   
				
            </ul>			
			<ul class="nav navright">
				<li class="dropdown works">
				<a data-pjax href="#" title="作品集" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-th-large"></i>Works <b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="drop1">
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://github.com/wzpan/wukong-robot" title="wukong-robot 是一个简单、灵活、优雅的中文语音对话机器人。"><i class="fa fa-github"></i>wukong-robot</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://hahack.com/codes/dingdang-robot-intro/" title="叮当是一款可以工作在 Raspberry Pi 上的中文语音对话机器人/智能音箱项目。"><i class="fa fa-github"></i>dingdang-robot</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://www.hahack.com/codes/comment-js/" title="纯JS实现的静态站点评论系统，使用 Github/OSChina 作为 backend。"><i class="fa fa-github"></i>comment.js</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://hahack.com/codes/eulerian-video-magnification/" title="首个完整的 C++ 开源实现，能同时放大动作变化和颜色变化"><i class="fa fa-github"></i>QtEVM</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/wzpan/wzpan.github.io/wiki/hexo-series" title="为 Hexo 写的一系列主题/工具/插件"><i class="fa fa-github"></i>hexo-series</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/scnu/scnuthesis" title="符合华南师范大学硕士/博士学位论文格式要求的LaTeX模板。"><i class="fa fa-github"></i>SCNUThesis</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/wzpan/wzpan.github.io/wiki/slides" title="一些幻灯片作品"><i class="fa fa-github"></i>Slides</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://hahack.com/codes/fcevm/" title="硕士毕业论文"><i class="fa fa-github"></i>Dissertation</a></li>
				
                	        </ul>
				</li>
				<li class="dropdown">
				<a data-pjax href="#" title="订阅本站" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-rss"></i>Subscribe <b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="drop2">
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" href="/atom.xml" title="使用 RSS 阅读器订阅 HaHack"><i class="fa fa-rss-square"></i>RSS</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" href="/wechat.html" title="订阅 HaHack 的公众平台"><i class="fa fa-qrcode"></i>WeChat</a></li>
				
				   <li role="presentation"><a role="menuitem" tabindex="-1" href="http://toutiao.io/u/147640" title=""><i class="fa fa-align-justify"></i>Toutiao</a></li>
				
                	        </ul>
				</li>
				
				<li><a data-pjax href="/about" title="关于我"><i class="fa fa-user"></i>About</a></li>				   				
   					  
            </ul>
            </div> <!-- nav-collapse collapse -->
        </div> <!-- container -->
     </div> <!-- navbar-inner -->
</div> <!-- navbar navbar-inverse -->
</header>
  <div class="container" id="container">
  	<div class="content">
    	 

	
		<div class="page-header">		
			<h1> 工具栈</h1>
		</div>    
	



<div class="row-fluid wiki">
	<!-- span -->
    
        <div class="span3 toc"></div>
        <div class="span9 note">
    

	

		<!-- content -->
		<p>JavaScript 拥有非常丰富的工具栈。</p>
<h2 id="版本管理">版本管理</h2>
<h3 id="nvm">nvm</h3>
<p>nvm 是 node.js 的版本管理工具。安装 nvm 需要打开命令行窗口，运行下面的命令。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl -<span class="keyword">o</span>- http<span class="variable">s:</span>//raw.githubusercontent.<span class="keyword">com</span>/creationix/nvm/&lt;<span class="keyword">version</span> <span class="keyword">number</span>&gt;/install.<span class="keyword">sh</span> | bash</div></pre></td></tr></table></figure></p>
<p>上面命令的 version number 处，需要用版本号替换。本节写作时的版本号是v0.29.0。该命令运行后，nvm会默认安装在用户主目录的 .nvm 子目录。</p>
<p>然后，激活 nvm 。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">source</span> ~/.nvm/nvm.<span class="keyword">sh</span></div></pre></td></tr></table></figure></p>
<p>激活以后，安装Node的最新版。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>nvm install node</div></pre></td></tr></table></figure></p>
<p>安装完成后，切换到该版本。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>nvm <span class="keyword">use</span> node</div></pre></td></tr></table></figure></p>
<h2 id="es6-兼容性">ES6 兼容性</h2>
<h3 id="babel-转码器">Babel 转码器</h3>
<p>Babel是一个广泛使用的ES6转码器，可以将ES6代码转为ES5代码，从而在现有环境执行。这意味着，你可以用ES6的方式编写程序，又不用担心现有环境是否支持。下面是一个例子。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 转码前</div><div class="line"><span class="built_in">input</span>.<span class="built_in">map</span>(item =&gt; item + <span class="number">1</span>);</div><div class="line"></div><div class="line">// 转码后</div><div class="line"><span class="built_in">input</span>.<span class="built_in">map</span>(<span class="function"><span class="keyword">function</span> <span class="params">(item)</span> {</span></div><div class="line">  <span class="keyword">return</span> item + <span class="number">1</span>;</div><div class="line">});</div></pre></td></tr></table></figure></p>
<p>上面的原始代码用了箭头函数，这个特性还没有得到广泛支持，Babel将其转为普通函数，就能在现有的JavaScript环境执行了。</p>
<h4 id="配置文件-babelrc">配置文件.babelrc</h4>
<p>Babel的配置文件是.babelrc，存放在项目的根目录下。使用Babel的第一步，就是配置这个文件。</p>
<p>该文件用来设置转码规则和插件，基本格式如下。</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">presets</span>": <span class="value">[]</span>,</div><div class="line">  "<span class="attribute">plugins</span>": <span class="value">[]</span></div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>presets 字段设定转码规则，官方提供以下的规则集，你可以根据需要安装。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># ES2015转码规则</div><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save-dev babel-preset-es2015</span></span></div><div class="line"></div><div class="line"># react转码规则</div><div class="line">$ npm <span class="keyword">install</span> <span class="comment">--save-dev babel-preset-react</span></div><div class="line"></div><div class="line"># ES7不同阶段语法提案的转码规则（共有<span class="number">4</span>个阶段），选装一个</div><div class="line">$ npm <span class="keyword">install</span> <span class="comment">--save-dev babel-preset-stage-0</span></div><div class="line">$ npm <span class="keyword">install</span> <span class="comment">--save-dev babel-preset-stage-1</span></div><div class="line">$ npm <span class="keyword">install</span> <span class="comment">--save-dev babel-preset-stage-2</span></div><div class="line">$ npm <span class="keyword">install</span> <span class="comment">--save-dev babel-preset-stage-3</span></div></pre></td></tr></table></figure></p>
<p>然后，将这些规则加入.babelrc。</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">presets</span>": <span class="value">[</span></div><div class="line">    <span class="string">"es2015"</span>,</div><div class="line">    <span class="string">"react"</span>,</div><div class="line">    <span class="string">"stage-2"</span></div><div class="line">  ],</div><div class="line">  "<span class="attribute">plugins</span>": <span class="value">[]</span></div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>注意，以下所有Babel工具和模块的使用，都必须先写好.babelrc。</p>
<h4 id="命令行转码babel-cli">命令行转码babel-cli</h4>
<p>Babel提供babel-cli工具，用于命令行转码。</p>
<p>它的安装命令如下。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install --<span class="built_in">global</span> babel-<span class="keyword">cli</span></div></pre></td></tr></table></figure></p>
<p>基本用法如下。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor"># 转码结果输出到标准输出</span></div><div class="line">$ babel example.js</div><div class="line"></div><div class="line"><span class="preprocessor"># 转码结果写入一个文件</span></div><div class="line"><span class="preprocessor"># --out-file 或 -o 参数指定输出文件</span></div><div class="line">$ babel example.js --out-file compiled.js</div><div class="line"><span class="preprocessor"># 或者</span></div><div class="line">$ babel example.js -o compiled.js</div><div class="line"></div><div class="line"><span class="preprocessor"># 整个目录转码</span></div><div class="line"><span class="preprocessor"># --out-dir 或 -d 参数指定输出目录</span></div><div class="line">$ babel src --out-dir lib</div><div class="line"><span class="preprocessor"># 或者</span></div><div class="line">$ babel src -d lib</div><div class="line"></div><div class="line"><span class="preprocessor"># -s 参数生成source map文件</span></div><div class="line">$ babel src -d lib -s</div></pre></td></tr></table></figure></p>
<p>上面代码是在全局环境下，进行Babel转码。这意味着，如果项目要运行，全局环境必须有Babel，也就是说项目产生了对环境的依赖。另一方面，这样做也无法支持不同项目使用不同版本的Babel。</p>
<p>一个解决办法是将babel-cli安装在项目之中。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 安装</span></div><div class="line"><span class="variable">$ </span>npm install --save-dev babel-cli</div></pre></td></tr></table></figure></p>
<p>然后，改写package.json。</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  // ...</div><div class="line">  "devDependencies": {</div><div class="line">    "babel-cli": "^6.0.0"</div><div class="line">  },</div><div class="line">  "scripts": {</div><div class="line">    "build": "babel src -d lib"</div><div class="line">  },</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>转码的时候，就执行下面的命令。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>npm run build</div></pre></td></tr></table></figure></p>
<h4 id="babel-node">babel-node</h4>
<p>babel-cli工具自带一个babel-node命令，提供一个支持ES6的REPL环境。它支持Node的REPL环境的所有功能，而且可以直接运行ES6代码。</p>
<p>它不用单独安装，而是随babel-cli一起安装。然后，执行babel-node就进入REPL环境。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">$ babel-node</span></span></div><div class="line">&gt; (x =&gt; x * <span class="number">2</span>)(<span class="number">1</span>)</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>babel-node命令可以直接运行ES6脚本。将上面的代码放入脚本文件es6.js，然后直接运行。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>babel-node es6.js</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure></p>
<p>babel-node也可以安装在项目中。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save-dev babel-cli</span></span></div></pre></td></tr></table></figure></p>
<p>然后，改写package.json。</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">scripts</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">script-name</span>": <span class="value"><span class="string">"babel-node script.js"</span></span></div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>上面代码中，使用babel-node替代node，这样script.js本身就不用做任何转码处理。</p>
<h4 id="babel-register">babel-register</h4>
<p>babel-register模块改写require命令，为它加上一个钩子。此后，每当使用require加载.js、.jsx、.es和.es6后缀名的文件，就会先用Babel进行转码。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save-dev babel-register</span></span></div></pre></td></tr></table></figure></p>
<p>使用时，必须首先加载babel-register。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">"babel-register"</span>);</div><div class="line"><span class="built_in">require</span>(<span class="string">"./index.js"</span>);</div></pre></td></tr></table></figure></p>
<p>然后，就不需要手动对index.js转码了。</p>
<p>需要注意的是，babel-register只会对require命令加载的文件转码，而不会对当前文件转码。另外，由于它是实时转码，所以<strong>只适合在开发环境使用</strong>。</p>
<h4 id="babel-core">babel-core</h4>
<p>如果某些代码需要调用Babel的API进行转码，就要使用babel-core模块。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> babel-core <span class="comment">--save</span></span></div></pre></td></tr></table></figure></p>
<p>然后，在项目中就可以调用babel-core。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'babel-core'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 字符串转码</span></div><div class="line">babel.transform(<span class="string">'code();'</span>, options);</div><div class="line"><span class="comment">// =&gt; { code, map, ast }</span></div><div class="line"></div><div class="line"><span class="comment">// 文件转码（异步）</span></div><div class="line">babel.transformFile(<span class="string">'filename.js'</span>, options, <span class="function"><span class="keyword">function</span><span class="params">(err, result)</span> </span>{</div><div class="line">  result; <span class="comment">// =&gt; { code, map, ast }</span></div><div class="line">});</div><div class="line"></div><div class="line"><span class="comment">// 文件转码（同步）</span></div><div class="line">babel.transformFileSync(<span class="string">'filename.js'</span>, options);</div><div class="line"><span class="comment">// =&gt; { code, map, ast }</span></div><div class="line"></div><div class="line"><span class="comment">// Babel AST转码</span></div><div class="line">babel.transformFromAst(ast, code, options);</div><div class="line"><span class="comment">// =&gt; { code, map, ast }</span></div></pre></td></tr></table></figure></p>
<p>配置对象<code>options</code>，可以参看官方文档http://babeljs.io/docs/usage/options/。</p>
<p>下面是一个例子。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> es6Code = <span class="string">'let x = n =&gt; n + 1'</span>;</div><div class="line"><span class="keyword">var</span> es5Code = <span class="built_in">require</span>(<span class="string">'babel-core'</span>)</div><div class="line">  .transform(es6Code, {</div><div class="line">    presets: [<span class="string">'es2015'</span>]</div><div class="line">  })</div><div class="line">  .code;</div><div class="line"><span class="comment">// '"use strict";\n\nvar x = function x(n) {\n  return n + 1;\n};'</span></div></pre></td></tr></table></figure></p>
<h4 id="babel-polyfill">babel-polyfill</h4>
<p>Babel默认只转换新的JavaScript句法（syntax），而不转换新的API，比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。</p>
<p>举例来说，ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
<p>安装命令如下。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save babel-polyfill</span></span></div></pre></td></tr></table></figure></p>
<p>然后，在脚本头部，加入如下一行代码。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import <span class="string">'babel-polyfill'</span>;</div><div class="line"><span class="comment">// 或者</span></div><div class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>);</div></pre></td></tr></table></figure></p>
<p>Babel默认不转码的API非常多，详细清单可以查看<code>babel-plugin-transform-runtime</code>模块的<a href="https://github.com/babel/babel/blob/master/packages/babel-plugin-transform-runtime/src/definitions.js" target="_blank" rel="external">definitions.js</a>文件。</p>
<h4 id="浏览器环境">浏览器环境</h4>
<p>Babel也可以用于浏览器环境。但是，从Babel 6.0开始，不再直接提供浏览器版本，而是要用构建工具构建出来。如果你没有或不想使用构建工具，可以通过安装5.x版本的babel-core模块获取。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>npm install babel-core<span class="variable">@5</span></div></pre></td></tr></table></figure></p>
<p>运行上面的命令以后，就可以在当前目录的node_modules/babel-core/子目录里面，找到babel的浏览器版本browser.js（未精简）和browser.min.js（已精简）。</p>
<p>然后，将下面的代码插入网页。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"node_modules/babel-core/browser.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/babel"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">// Your ES6 code</span></div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上面代码中，browser.js是Babel提供的转换器脚本，可以在浏览器运行。用户的ES6脚本放在script标签之中，但是要注明 <code>type=&quot;text/babel&quot;</code> 。</p>
<p>另一种方法是使用babel-standalone模块提供的浏览器版本，将其插入网页。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/babel"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">// Your ES6 code</span></div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>注意，网页中实时将ES6代码转为ES5，对性能会有影响。生产环境需要加载已经转码完成的脚本。</p>
<p>下面是如何将代码打包成浏览器可以使用的脚本，以Babel配合Browserify为例。首先，安装babelify模块。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save-dev babelify babel-preset-es2015</span></span></div></pre></td></tr></table></figure></p>
<p>然后，再用命令行转换ES6脚本。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$  browserify <span class="keyword">script</span>.js -o bundle.js \</div><div class="line">  -t [ babelify <span class="comment">--presets [ es2015 ] ]</span></div></pre></td></tr></table></figure></p>
<p>上面代码将ES6脚本script.js，转为bundle.js，浏览器直接加载后者就可以了。</p>
<p>在package.json设置下面的代码，就不用每次命令行都输入参数了。</p>
<p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  "<span class="attribute">browserify</span>": <span class="value">{</span></div><div class="line">    "<span class="attribute">transform</span>": <span class="value">[[<span class="string">"babelify"</span>, { "<span class="attribute">presets</span>": <span class="value">[<span class="string">"es2015"</span>] </span>}]]</span></div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure></p>
<h4 id="在线转换">在线转换</h4>
<p>Babel提供一个<a href="https://babeljs.io/repl/" target="_blank" rel="external">REPL在线编译器</a>，可以在线将ES6代码转为ES5代码。转换后的代码，可以直接作为ES5代码插入网页运行。</p>
<h3 id="traceur转码器">Traceur转码器</h3>
<p>Google公司的<a href="https://github.com/google/traceur-compiler" target="_blank" rel="external">Traceur</a>转码器，也可以将ES6代码转为ES5代码。</p>
<h4 id="直接插入网页">直接插入网页</h4>
<p>Traceur允许将ES6代码直接插入网页。首先，必须在网页头部加载Traceur库文件。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://google.github.io/traceur-compiler/bin/traceur.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://google.github.io/traceur-compiler/bin/BrowserSystem.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://google.github.io/traceur-compiler/src/bootstrap.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"module"</span>&gt;</span><span class="javascript"></span></div><div class="line">  import <span class="string">'./Greeter.js'</span>;</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上面代码中，一共有4个script标签。第一个是加载Traceur的库文件，第二个和第三个是将这个库文件用于浏览器环境，第四个则是加载用户脚本，这个脚本里面可以使用ES6代码。</p>
<p>注意，第四个script标签的type属性的值是module，而不是text/javascript。这是Traceur编译器识别ES6代码的标志，编译器会自动将所有<code>type=module</code>的代码编译为ES5，然后再交给浏览器执行。</p>
<p>除了引用外部ES6脚本，也可以直接在网页中放置ES6代码。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"module"</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">class</span> Calc {</div><div class="line">    constructor(){</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'Calc constructor'</span>);</div><div class="line">    }</div><div class="line">    add(a, b){</div><div class="line">      <span class="keyword">return</span> a + b;</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">var</span> c = <span class="keyword">new</span> Calc();</div><div class="line">  <span class="built_in">console</span>.log(c.add(<span class="number">4</span>,<span class="number">5</span>));</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>正常情况下，上面代码会在控制台打印出9。</p>
<p>如果想对Traceur的行为有精确控制，可以采用下面参数配置的写法。</p>
<p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="comment">// Create the System object</span></div><div class="line">  <span class="built_in">window</span>.System = <span class="keyword">new</span> traceur.runtime.BrowserTraceurLoader();</div><div class="line">  <span class="comment">// Set some experimental options</span></div><div class="line">  <span class="keyword">var</span> metadata = {</div><div class="line">    traceurOptions: {</div><div class="line">      experimental: <span class="literal">true</span>,</div><div class="line">      properTailCalls: <span class="literal">true</span>,</div><div class="line">      symbols: <span class="literal">true</span>,</div><div class="line">      arrayComprehension: <span class="literal">true</span>,</div><div class="line">      asyncFunctions: <span class="literal">true</span>,</div><div class="line">      asyncGenerators: exponentiation,</div><div class="line">      forOn: <span class="literal">true</span>,</div><div class="line">      generatorComprehension: <span class="literal">true</span></div><div class="line">    }</div><div class="line">  };</div><div class="line">  <span class="comment">// Load your module</span></div><div class="line">  System.import(<span class="string">'./myModule.js'</span>, {metadata: metadata}).catch(<span class="function"><span class="keyword">function</span><span class="params">(ex)</span> </span>{</div><div class="line">    <span class="built_in">console</span>.error(<span class="string">'Import failed'</span>, ex.stack || ex);</div><div class="line">  });</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上面代码中，首先生成Traceur的全局对象<code>window.System</code>，然后<code>System.import</code>方法可以用来加载ES6模块。加载的时候，需要传入一个配置对象metadata，该对象的traceurOptions属性可以配置支持ES6功能。如果设为<code>experimental: true</code>，就表示除了ES6以外，还支持一些实验性的新功能。</p>
<h4 id="在线转换-v2">在线转换</h4>
<p>Traceur也提供一个<a href="http://google.github.io/traceur-compiler/demo/repl.html" target="_blank" rel="external">在线编译器</a>，可以在线将ES6代码转为ES5代码。转换后的代码，可以直接作为ES5代码插入网页运行。</p>
<h4 id="命令行转换">命令行转换</h4>
<p>作为命令行工具使用时，Traceur是一个Node的模块，首先需要用Npm安装。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>npm install -g traceur</div></pre></td></tr></table></figure></p>
<p>安装成功后，就可以在命令行下使用Traceur了。</p>
<p>Traceur直接运行es6脚本文件，会在标准输出显示运行结果，以前面的calc.js为例。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ traceur calc.js</div><div class="line">Calc <span class="function"><span class="keyword">constructor</span></span></div><div class="line">9</div></pre></td></tr></table></figure></p>
<p>如果要将ES6脚本转为ES5保存，要采用下面的写法。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">$</span> <span class="comment">traceur</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">script</span> <span class="comment">calc</span><span class="string">.</span><span class="comment">es6</span><span class="string">.</span><span class="comment">js</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">out</span> <span class="comment">calc</span><span class="string">.</span><span class="comment">es5</span><span class="string">.</span><span class="comment">js</span></div></pre></td></tr></table></figure></p>
<p>上面代码的<code>--script</code>选项表示指定输入文件，<code>--out</code>选项表示指定输出文件。</p>
<p>为了防止有些特性编译不成功，最好加上–experimental选项。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">$</span> <span class="comment">traceur</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">script</span> <span class="comment">calc</span><span class="string">.</span><span class="comment">es6</span><span class="string">.</span><span class="comment">js</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">out</span> <span class="comment">calc</span><span class="string">.</span><span class="comment">es5</span><span class="string">.</span><span class="comment">js</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">experimental</span></div></pre></td></tr></table></figure></p>
<p>命令行下转换生成的文件，就可以直接放到浏览器中运行。</p>
<h4 id="node-js环境的用法">Node.js环境的用法</h4>
<p>Traceur的 Node.js 用法如下（假定已安装traceur模块）。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> traceur = <span class="built_in">require</span>(<span class="string">'traceur'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 将ES6脚本转为字符串</span></div><div class="line"><span class="keyword">var</span> contents = fs.readFileSync(<span class="string">'es6-file.js'</span>).toString();</div><div class="line"></div><div class="line"><span class="keyword">var</span> result = traceur.compile(contents, {</div><div class="line">  filename: <span class="string">'es6-file.js'</span>,</div><div class="line">  sourceMap: <span class="literal">true</span>,</div><div class="line">  <span class="comment">// 其他设置</span></div><div class="line">  modules: <span class="string">'commonjs'</span></div><div class="line">});</div><div class="line"></div><div class="line"><span class="keyword">if</span> (result.error)</div><div class="line">  <span class="keyword">throw</span> result.error;</div><div class="line"></div><div class="line"><span class="comment">// result对象的js属性就是转换后的ES5代码</span></div><div class="line">fs.writeFileSync(<span class="string">'out.js'</span>, result.js);</div><div class="line"><span class="comment">// sourceMap属性对应map文件</span></div><div class="line">fs.writeFileSync(<span class="string">'out.js.map'</span>, result.sourceMap);</div></pre></td></tr></table></figure></p>
<h2 id="强类型">强类型</h2>
<p>JavaScript 是一种弱类型（或称动态类型）语言，即变量的类型是不确定的。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = <span class="number">5</span>; <span class="comment">// 5</span></div><div class="line">x = x + <span class="string">'A'</span>; <span class="comment">// '5A'</span></div></pre></td></tr></table></figure></p>
<p>弱类型的好处是十分灵活，可以写出非常简洁的代码。但是，对于大型项目来说，强类型更有利，可以降低系统的复杂度，在编译时就发现类型错误，减轻程序员的负担。</p>
<h3 id="typescript">TypeScript</h3>
<p><a href="http://www.typescriptlang.org/" target="_blank" rel="external">TypeScript</a> 是微软2012年推出的一种编程语言，属于 JavaScript 的超集，可以编译为 JavaScript 执行。 它的最大特点就是支持强类型和 <a href="/wiki/javascript-es6.html">ES6 Class</a>。</p>
<p>首先，安装TypeScript。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>npm install -g typescript</div></pre></td></tr></table></figure></p>
<p>然后，为变量指定类型。</p>
<p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// greet.ts</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span><span class="params">(person: string)</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Hello, "</span> + person);</div><div class="line">}</div><div class="line"></div><div class="line">greet([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]);</div></pre></td></tr></table></figure></p>
<p>上面是文件 greet.ts 的代码，后缀名 ts 表明这是 TypeScript 的代码。函数 greet 的参数，声明类型为字符串，但在调用时，传入了一个数组。</p>
<p>使用 tsc 命令将 ts 文件编译为 js 文件，就会抛出类型不匹配的错误。</p>
<p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ tsc greeter.ts</div><div class="line"></div><div class="line">greet.ts(<span class="number">5</span>,<span class="number">9</span>): error TS2345: Argument of type <span class="string">'number[]'</span>   </div><div class="line">is not assignable to parameter of type <span class="string">'string'</span>.</div></pre></td></tr></table></figure></p>
<h3 id="flowcheck">Flowcheck</h3>
<p><a href="http://gcanti.github.io/flowcheck/" target="_blank" rel="external">Flowcheck</a> 是一个轻量级的类型断言库，可以在运行时（runtime）检查变量类型是否正确。</p>
<p>首先，安装Flowcheck。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>npm install -g flowcheck</div></pre></td></tr></table></figure></p>
<p>然后，编写一个声明了变量类型的脚本。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(a: number, b: number)</span> </span>{</div><div class="line">  <span class="keyword">return</span> a + b;</div><div class="line">}</div><div class="line"></div><div class="line">sum(<span class="string">'hello'</span>,<span class="string">'world'</span>)</div></pre></td></tr></table></figure></p>
<p>接着，使用下面的命令，将脚本转换为正常的 JavaScript 文件。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ browserify -<span class="keyword">t</span> flowcheck -<span class="keyword">t</span> [reactify --strip-types] \</div><div class="line"><span class="built_in">input</span>.js -<span class="keyword">o</span> output.js</div></pre></td></tr></table></figure></p>
<p>转换后的文件如下。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _f = <span class="built_in">require</span>(<span class="string">"flowcheck/assert"</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(a, b)</span> </span>{</div><div class="line">    _f.check(<span class="built_in">arguments</span>, _f.arguments([_f.number, _f.number]));</div><div class="line">  <span class="keyword">return</span> a + b;</div><div class="line">}</div></pre></td></tr></table></figure></p>
<p>可以看到，代码中插入一个断言库。每次运行函数之前，会先执行断言，如果类型不符就报错。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ node output.js<span class="comment"></span></div><div class="line">// throw new TypeError(message);</div><div class="line">            ^</div><div class="line">TypeError: </div><div class="line"></div><div class="line">Expected <span class="operator">an</span> instance <span class="operator">of</span> <span class="built_in">number</span> got <span class="string">"hello"</span>,   </div><div class="line">context: arguments / [<span class="built_in">number</span>, <span class="built_in">number</span>] / <span class="number">0</span></div><div class="line"></div><div class="line">Expected <span class="operator">an</span> instance <span class="operator">of</span> <span class="built_in">number</span> got <span class="string">"world"</span>,  </div><div class="line">context: arguments / [<span class="built_in">number</span>, <span class="built_in">number</span>] / <span class="number">1</span></div></pre></td></tr></table></figure></p>
<h3 id="flow">Flow</h3>
<p><a href="http://flowtype.org/" target="_blank" rel="external">Flow</a> 是 Facebook 在2014年发布的一个类型检查工具，用来检查 React 的源码。
安装命令如下。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm <span class="operator"><span class="keyword">install</span> <span class="comment">--global flow-bin</span></span></div></pre></td></tr></table></figure></p>
<p>Flow 的用法很多，我只举几个例子。前文介绍的两种工具，只能检查声明了类型的变量，而 Flow 可以推断变量类型。</p>
<p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// hello.js</span></div><div class="line"><span class="comment">/* @flow */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(x)</span> </span>{</div><div class="line">  <span class="keyword">return</span> x*<span class="number">10</span>;</div><div class="line">}</div><div class="line">foo(<span class="string">"Hello, world!"</span>);</div></pre></td></tr></table></figure></p>
<p>上面是文件 hello.js ，该文件的第一行是注释，表明需要使用 Flow 检查变量类型。</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ flow <span class="operator"><span class="keyword">check</span></span></div><div class="line">hello.js:<span class="number">7</span>:<span class="number">5</span>,<span class="number">19</span>: <span class="keyword">string</span></div><div class="line">This type <span class="keyword">is</span> incompatible <span class="keyword">with</span></div><div class="line">/hello.js:<span class="number">4</span>:<span class="number">10</span>,<span class="number">13</span>: <span class="built_in">number</span></div></pre></td></tr></table></figure></p>
<p>运行 <code>flow check</code> 命令，得到报错信息：预期函数 foo 的参数是一个数值，但是实际为一个字符串。</p>
<p>Flow 也支持变量的类型声明。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* @flow */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(x: string, y: number)</span>: <span class="title">string</span> </span>{</div><div class="line">  <span class="keyword">return</span> x.length * y;</div><div class="line">}</div><div class="line">foo(<span class="string">"Hello"</span>, <span class="number">42</span>);</div></pre></td></tr></table></figure></p>
<p>另一个有趣的功能是，Flow 可以将类型注释（annotation），转为类型声明。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// annotation.js</span></div><div class="line"><span class="comment">/**</span></div><div class="line">  @param {number} x</div><div class="line">  @return {number}</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(x)</span> </span>{</div><div class="line">  <span class="keyword">return</span> x * x;</div><div class="line">}</div><div class="line">square(<span class="number">5</span>);</div></pre></td></tr></table></figure></p>
<p>运行 <code>flow port</code> 命令，会得到下面的结果。</p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ flow port annotation.js</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">square</span><span class="params">(x: number)</span> : <span class="title">number</span> </span>{</div><div class="line">   <span class="keyword">return</span> x * x;</div><div class="line"> }</div></pre></td></tr></table></figure></p>
<p>Flow 的更多介绍，可以阅读<a href="http://www.crmarsh.com/flow/" target="_blank" rel="external">《Exploring Flow, Facebook’s Type Checker for JavaScript》</a>。
本文的原始幻灯片点击<a href="http://slides.ruanyifeng.com/type/" target="_blank" rel="external">这里</a>（里面有更多内容）。</p>
<h2 id="本文参考材料">本文参考材料</h2>
<ul>
<li><a href="http://es6.ruanyifeng.com/#docs/intro" target="_blank" rel="external">阮一峰 - ECMAScript 6 入门</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2015/02/strong-typing-javascript.html" target="_blank" rel="external">阮一峰 - 强类型 JavaScript 的解决方案</a></li>
</ul>


		<!-- pagination -->
		<div>
		<center>
		<div class="pagination">
<ul class="pagination">
	
	
	
		
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
			
		
	
	    
			
		
	
	    
	
	    
			
		
	
	    
			
			
		
	
	    
			
			
			
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
	
	    
			
		
	
	    
	
	
		<li class="prev"><a data-pjax href="/wiki/javascript-es6.html" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
	
	<li><a data-pjax href="/wiki"><i class="fa fa-tasks"></i>Wiki</a></li>
	
		<li class="next"><a data-pjax href="/wiki/javascript-tables.html" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>
	
</ul>
</div>

	    </center>
		</div>
				
		<!-- toc -->
		
   	<script type="text/javascript">
		jQuery(document).ready(function() {
		
 		   generateWikiTOC('.note', '.toc',  2 , 2 );
		
		});
	</script>



				
		<!-- comment -->
		
<section id="comment">
    <h2 class="title">Comments</h2>
	
	 <div id="comment-thread"></div>
	 <div id="loading-spin"></div>
	 <script type="text/javascript">
	   getComments({
		       type: "github",
	           user: "wzpan",
	           repo: "wzpan.github.io",
			   client_id: "1eb35434de75c06a513f",
			   client_secret: "6e4193f8ecd619cdfac2b1aa16b3663fe18d2e90",
			   no_comment: "暂时还没有留言呢，点击下面的按钮去留言吧！",
			   go_to_comment: "去留言",
			   btn_class: "btn btn-primary",
			   no_issue: "no_issue",
			   issue_title: "工具栈",
			   issue_id: "undefined",
			   comments_target: "#comment-thread" ? "#comment-thread" : "#comment-thread",
			   loading_target: "undefined"
			   });
	 </script>
	
</section>


		

	</div> <!-- span9/span12 -->
</div><!-- row-fluid post-full -->

	</div>	
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2019 Joseph Pan
  
    <small>
     <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh"><img title="知识共享许可协议" style="border-width: 0px; vertical-align: middle; display: inline; " src="/images/license.png"></a>
    </small>
</p>
 </footer>
</div> <!-- container-narrow -->


<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/dist/jquery.imagesloaded.min.js"></script>


<script src="/dist/gallery.min.js"></script>
<script src="/dist/bootstrap.min.js"></script>
<script src="/dist/jquery.tableofcontents.min.js"></script>
<script src="/dist/tocgenerator.min.js"></script>
<script src="/dist/require.min.js"></script>
<script src="/dist/main.min.js"></script>



<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox({
    helpers : { 
        title : { type : 'inside' }
    },
    afterLoad : function() {
        this.title = (this.title ? '' + this.title + '<br />' : '') + 'Image ' + (this.index + 1) + ' of ' + this.group.length;
    }
  });
})(jQuery);
</script>




<!-- syntax highlighting -->

  <script>
  marked.setOptions({
    highlight: function (code, lang) {
        return hljs.highlightAuto(code).value;
    }
  });
  function Highlighting(){
    var markdowns = document.getElementsByClassName('markdown');
    for(var i=0;i<markdowns.length;i++){
        if(markdowns[i].innerHTML) markdowns[i].innerHTML =marked(markdowns[i].innerHTML);
    }
  }
  window.addEventListener('DOMContentLoaded', Highlighting, false);
  window.addEventListener('load', Highlighting, false);
  </script>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','ney3Rb77vMaWT2KUKFyt');
</script>



</body>
</html>
